<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAL√ö Chocobananas - Men√∫ y Pedidos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        html {
            scroll-behavior: smooth;
        }
        <!-- SABORES (muestra todos; deshabilita los agotados) -->
<div style="max-width:520px;margin:20px auto;font-family:system-ui">
  <label for="saborSelect" style="display:block;margin:0 0 8px;font-weight:600">
    Elige tu sabor (los agotados aparecen deshabilitados)
  </label>
  <select id="saborSelect" required
          style="width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;background:#fff">
    <option value="">Cargando sabores...</option>
  </select>
  <div id="saborEstado" style="margin-top:8px;color:#666;font-size:14px"></div>
  <div id="saborError" style="margin-top:8px;color:#b00020;display:none"></div>
</div>

<script>
// Tu endpoint de Apps Script (SIN filtros; trae todos)
const ENDPOINT = "https://script.google.com/macros/s/AKfycby1338axelHJNTGzjfwWytZFHl2ZgiwlyE9C1HesdG99f-b8qi8960FKFM9UtbEpmU/exec";

// Refrescar cada N segundos (puedes subirlo si quieres menos consumo)
const REFRESH_MS = 60000;

function toBool(v){
  const s = String(v ?? "").trim().toLowerCase();
  return s === "true" || s === "1" || s === "si" || s === "s√≠" || s === "x" || s === "‚úì";
}

async function cargarSaboresTodos() {
  const sel   = document.getElementById("saborSelect");
  const info  = document.getElementById("saborEstado");
  const error = document.getElementById("saborError");

  // guarda selecci√≥n actual para intentar conservarla tras el refresh
  const prev = sel.value;

  sel.innerHTML = '<option value="">Elige un sabor...</option>';
  info.textContent = "";
  error.style.display = "none";

  try {
    const res = await fetch(ENDPOINT, { cache: "no-store" });
    if (!res.ok) throw new Error("No se pudo leer la hoja");
    let data = await res.json(); // [{id,sabor,precio,disponible,nota}, ...]

    if (!Array.isArray(data)) data = [];

    // normaliza bool y ordena: disponibles primero
    data = data.map(r => ({
      id: String(r.id ?? "").trim(),
      sabor: String(r.sabor ?? "").trim(),
      precio: String(r.precio ?? "").trim(),
      disponible: toBool(r.disponible),
      nota: String(r.nota ?? "").trim(),
    })).sort((a,b)=> Number(b.disponible) - Number(a.disponible));

    if (data.length === 0) {
      sel.innerHTML = '<option value="">Sin datos</option>';
      info.textContent = "No hay sabores cargados.";
      return;
    }

    let disponibles = 0;

    for (const s of data) {
      if (!s.sabor) continue;
      const precioTxt = s.precio ? ` - $${s.precio}` : "";
      const opt = document.createElement("option");
      opt.value = s.sabor;
      opt.textContent = s.disponible ? `${s.sabor}${precioTxt}` : `${s.sabor} (agotado)`;
      if (!s.disponible) opt.disabled = true;
      sel.appendChild(opt);
      if (s.disponible) disponibles++;
    }

    // intenta restaurar la selecci√≥n anterior si sigue existiendo
    if ([...sel.options].some(o => o.value === prev && !o.disabled)) {
      sel.value = prev;
    }

    info.textContent = disponibles > 0
      ? `Disponibles ahora: ${disponibles} sabor(es).`
      : "Por ahora todos est√°n agotados üíõ";
  } catch (e) {
    error.textContent = "Error cargando sabores. Intenta en un momento.";
    error.style.display = "block";
    console.error(e);
  }
}

// carga inicial + auto-refresh
cargarSaboresTodos();
setInterval(cargarSaboresTodos, REFRESH_MS);_

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1B5E20; /* Darker Brand Green */
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(245, 124, 0, 0.1), transparent 50%),
                radial-gradient(circle at 85% 30%, rgba(134, 239, 172, 0.1), transparent 50%),
                radial-gradient(circle at 25% 10%, rgba(255, 255, 255, 0.1) 1px, transparent 2px),
                radial-gradient(circle at 75% 80%, rgba(255, 255, 255, 0.1) 1px, transparent 2px),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.08) 1px, transparent 2px),
                radial-gradient(circle at 90% 15%, rgba(255, 255, 255, 0.09) 1px, transparent 2px),
                radial-gradient(circle at 10% 85%, rgba(255, 255, 255, 0.1) 1px, transparent 2px);
            background-size: 100% 100%, 100% 100%, 50px 50px, 70px 70px, 60px 60px, 80px 80px, 40px 40px;
            overflow-x: hidden;
            color: #4a4a4a;
        }

        /* Chocobanana floating effect */
        .chocobanana-fall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .chocobanana-fall div {
            position: absolute;
            top: -200px;
            background-size: contain;
            background-repeat: no-repeat;
            animation: fall-down linear infinite;
            opacity: 0;
        }

        @keyframes fall-down {
            0% { transform: translateY(0) rotate(-20deg); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(120vh) rotate(60deg); opacity: 0; }
        }

        .chocobanana-fall div:nth-child(1) { left: 10%; width: 120px; height: 120px; background-image: url('https://i.postimg.cc/wBJcZcY3/1000670551-removebg-preview.webp'); animation-duration: 22s; animation-delay: 0s; }
        .chocobanana-fall div:nth-child(2) { left: 85%; width: 150px; height: 150px; background-image: url('https://i.postimg.cc/Kz2r2kmf/1000670552-removebg-preview.webp'); animation-duration: 18s; animation-delay: 3s; }
        .chocobanana-fall div:nth-child(3) { left: 50%; width: 100px; height: 100px; background-image: url('https://i.postimg.cc/Hkrt41Sw/1000670553-removebg-preview.webp'); animation-duration: 25s; animation-delay: 8s; }
        .chocobanana-fall div:nth-child(4) { left: 30%; width: 140px; height: 140px; background-image: url('https://i.postimg.cc/vBrgL0FL/1000670549-removebg-preview-1.webp'); animation-duration: 16s; animation-delay: 12s; }
        .chocobanana-fall div:nth-child(5) { left: 65%; width: 110px; height: 110px; background-image: url('https://i.postimg.cc/76n1YH6k/1000670555-removebg-preview.webp'); animation-duration: 28s; animation-delay: 15s; }
        
        /* Brand Colors */
        .brand-green-text { color: #2E7D32; }
        .brand-orange-text { color: #F57C00; }
        .brand-brown-text { color: #3D2B1F; }
        .bg-brand-green { background-color: #2E7D32; }
        .hover\:bg-brand-green-dark:hover { background-color: #1B5E20; }
        .bg-brand-orange { background-color: #F57C00; }
        .hover\:bg-brand-orange-dark:hover { background-color: #E65100; }
        
        /* Glossy text effect for the main headline */
        .glossy-text {
            text-shadow: 0 0 5px rgba(255,255,255,0.7), 
                         0 0 10px rgba(255,255,255,0.7), 
                         0 0 15px rgba(245, 124, 0, 0.5), 
                         0 0 20px rgba(245, 124, 0, 0.5);
        }

    </style>
</head>
<body class="text-gray-800">

    <div class="chocobanana-fall">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-2 flex justify-between items-center">
            <a href="#" onclick="showPage('home')" class="flex items-center gap-3">
                <img src="https://scontent.fptz1-1.fna.fbcdn.net/v/t1.6435-9/120623817_2756311547940742_4877580013596553030_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_ohc=mEQdu5xSycAQ7kNvwE9MaZS&_nc_oc=AdnW_LwBOBKzbCLPJnbHYRBLDwy5nb364G1MWPuam_DZujGlsV5ZDpXZmdvwVCTsOXE&_nc_zt=23&_nc_ht=scontent.fptz1-1.fna&_nc_gid=M5h8cPgjuu5YT6FtW6pIEA&oh=00_AfS4lCBjAcVVSa0Z9FIvD4nhb3rxEoMRffX247tuX_KEtw&oe=68B1EA8A" alt="Logo de VAL√ö Chocobananas" class="h-20 md:h-24 transition-all" onerror="this.onerror=null;this.src='https://placehold.co/96x96/FFF3E0/3D2B1F?text=V';">
            </a>
            <nav class="hidden md:flex items-center gap-6 font-semibold brand-brown-text">
                <a href="#productos" class="hover:brand-orange-text transition-colors">Productos</a>
                <a href="#experiencia" class="hover:brand-orange-text transition-colors">Experiencia</a>
                <a href="#footer-contact" class="hover:brand-orange-text transition-colors">Contacto</a>
            </nav>
            <button id="cart-button" onclick="showPage('checkout')" class="relative bg-brand-orange text-white px-4 py-2 rounded-full font-bold hover:bg-brand-orange-dark transition-colors flex items-center gap-2">
                <i class="fas fa-shopping-cart"></i>
                <span class="hidden sm:inline">Carrito</span>
                <span id="cart-count" class="absolute -top-2 -right-2 bg-brand-green text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
        </div>
    </header>

    <main id="home-page" class="relative z-10">
        <section class="py-20 md:py-24">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-6xl font-extrabold leading-tight mb-4 text-white glossy-text">M√°s que un postre, una experiencia.</h1>
                <p class="text-lg md:text-xl max-w-3xl mx-auto text-gray-300">Te esperamos en nuestro ambiente confortable que huele riqu√≠simo. Descubre una amplia carta de chocobananas que no sabr√°s cu√°l elegir.</p>
            </div>
        </section>
        
        <section id="productos" class="py-16">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold mb-12 text-center text-white" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.5);">Nuestros Sabores</h2>
                <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-12">
                    <!-- Product cards will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <section id="experiencia" class="pb-16">
            <div class="container mx-auto px-6">
                <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12 md:flex items-center gap-12">
                    <div class="md:w-1/2 mb-8 md:mb-0">
                        <img src="https://i.postimg.cc/htnht0Qv/504974765-1058337899724199-7091260268685360836-n.webp" alt="Interior del local de VAL√ö Chocobananas" class="rounded-lg shadow-lg w-full h-auto" onerror="this.onerror=null;this.src='https://placehold.co/600x400/FFF3E0/3D2B1F?text=Local';">
                    </div>
                    <div class="md:w-1/2">
                        <h2 class="text-3xl font-bold mb-4 brand-green-text">Nuestra Experiencia <span class="brand-orange-text">VAL√ö</span></h2>
                        <p class="mb-4 text-gray-600">Tu rinc√≥n favorito en el coraz√≥n de Shushufindi. Nacimos para convertir un postre cl√°sico en una experiencia inolvidable. Nos enorgullece ofrecerte la m√°s amplia y deliciosa carta de chocobananas que puedas imaginar.</p>
                        <p class="text-gray-600">M√°s que solo un producto, queremos que te sientas como en casa. Por eso, hemos creado un espacio amplio, confortable y con un ambiente s√∫per acogedor. ¬°Somos el punto de encuentro perfecto para todos los "Val√∫ Lovers"!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <main id="checkout-page" class="hidden relative z-10 py-16">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl text-center text-white glossy-text mb-12">Finalizar Pedido</h2>
            <div id="cart-empty-message" class="hidden text-center py-12 bg-white/90 rounded-2xl">
                <i class="fas fa-shopping-cart text-gray-300 text-6xl mb-4"></i>
                <p class="text-gray-500 text-xl">Tu carrito est√° vac√≠o.</p>
                <button onclick="showPage('home')" class="mt-6 bg-brand-orange text-white text-lg font-semibold py-3 px-8 rounded-full">Ver Productos</button>
            </div>
            <div id="cart-content" class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-2xl text-white mb-6">1. Tus Datos de Env√≠o</h3>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <form id="order-form">
                            <div class="mb-4">
                                <label for="name" class="block text-gray-700 font-bold mb-2">Nombre Completo</label>
                                <input type="text" id="name" name="name" class="w-full px-3 py-2 border rounded-lg" placeholder="Tu nombre" required>
                            </div>
                            <div class="mb-4">
                                <label for="phone" class="block text-gray-700 font-bold mb-2">N√∫mero de WhatsApp</label>
                                <input type="tel" id="phone" name="phone" class="w-full px-3 py-2 border rounded-lg" placeholder="Ej: 0999999999" required>
                            </div>
                            <div class="mb-4">
                                <label for="address" class="block text-gray-700 font-bold mb-2">Direcci√≥n de Entrega</label>
                                <textarea id="address" name="address" rows="3" class="w-full px-3 py-2 border rounded-lg" placeholder="Calle, barrio, referencia..." required></textarea>
                            </div>
                             <div class="flex justify-center">
                                <button type="button" id="share-location-btn-checkout" class="w-full bg-blue-500 text-white text-sm font-bold py-2 px-4 rounded-full hover:bg-blue-600 transition-colors flex items-center justify-center gap-2">
                                    <i class="fas fa-map-marker-alt"></i> Compartir Ubicaci√≥n
                                </button>
                            </div>
                            <p id="location-status-checkout" class="text-xs text-center text-green-600 font-semibold mt-2"></p>
                        </form>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl text-white">2. Resumen de tu Pedido</h3>
                        <button id="clear-cart-btn" title="Vaciar Carrito" class="text-red-300 hover:text-white text-sm font-semibold">Vaciar Carrito</button>
                    </div>
                    <div id="checkout-summary" class="bg-white p-6 rounded-lg shadow-md">
                        <!-- El resumen del carrito se insertar√° aqu√≠ -->
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md mt-8">
                        <h3 class="text-xl text-gray-700 mb-4 font-bold">Informaci√≥n de Pago</h3>
                        <div class="bg-blue-50 border border-blue-200 text-blue-800 p-3 rounded-lg text-sm">
                            <p><strong>Banco:</strong> Banco Pichincha</p>
                            <p><strong>Cuenta de Ahorros:</strong> 2208394961</p>
                            <p><strong>A nombre de:</strong> Monica Ruilova</p>
                            <p><strong>C.I:</strong> 0921738837</p>
                        </div>
                    </div>
                    <button type="submit" form="order-form" id="submit-order-btn" class="w-full bg-brand-orange text-white text-lg font-semibold py-3 rounded-full mt-8 hover:bg-brand-orange-dark transition-colors flex items-center justify-center gap-2">
                        <i class="fab fa-whatsapp"></i> Realizar Pedido
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer id="footer-contact" class="bg-gray-900/80 text-gray-300 pt-12 pb-8 mt-16 border-t border-white/10 relative z-10">
        <div class="container mx-auto px-6 text-center">
             <div class="grid md:grid-cols-3 gap-8">
                <div class="mb-6 md:mb-0">
                    <h4 class="font-bold text-lg mb-2 text-white">Contacto</h4>
                    <a href="https://wa.me/593963829892" target="_blank" class="inline-block hover:text-white transition-colors"><i class="fab fa-whatsapp mr-2"></i> +593 96 382 9892</a>
                    <p class="mt-2"><i class="fas fa-envelope mr-2"></i> valuchocobananas@gmail.com</p>
                </div>
                <div class="mb-6 md:mb-0"><h4 class="font-bold text-lg mb-2 text-white">Ubicaci√≥n</h4><a href="https://maps.app.goo.gl/ZjvLQER2vHgL6kSQ6" target="_blank" class="inline-block hover:text-white transition-colors"><i class="fas fa-map-marker-alt mr-2"></i> Siona y 7 de agosto</a><p>Shushufindi, Ecuador</p></div>
                <div class="mb-6 md:mb-0"><h4 class="font-bold text-lg mb-2 text-white">Horario</h4><p>Lunes a S√°bado</p><p>3:00 PM - 7:30 PM</p></div>
            </div>
            <div class="mt-8 pt-8 border-t border-white/20 text-sm text-white/70">
                <p>&copy; 2024 VAL√ö Chocobananas. Todos los derechos reservados.</p>
                <div class="mt-4">
                    <p class="text-xs text-white/50">
                        Te gustaria tener una pagina como esta, dale clic aqui ‚û§ 
                        <a href="https://wa.me/593983397264?text=Hola%20Bot%20&%20Landing,%20estoy%20interesado%20en%20una%20p√°gina%20web%20como%20la%20de%20VAL√ö%20Chocobananas." target="_blank" class="font-bold text-white/70 hover:text-white transition-colors">
                            Bot & Landing
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Confirmation Modal -->
    <div id="notification-modal" class="fixed inset-0 bg-black/60 z-[1002] flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-white rounded-xl p-8 text-center shadow-2xl max-w-sm transform scale-95 transition-transform duration-300">
            <i class="fas fa-check-circle text-green-500 text-5xl mb-4"></i>
            <h2 id="notification-message" class="text-xl font-bold brand-brown-text"></h2>
            <button id="close-notification-btn" class="mt-6 bg-brand-green text-white font-bold py-2 px-6 rounded-full">Entendido</button>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const products = [
            // $1.00
            { id: 1, name: 'Val√∫ √âbano', price: 1.00, img: 'https://i.postimg.cc/xdfT7hRY/IMG_20250809_164333_148_2-removebg-preview.webp', desc: 'Nuestra cl√°sica Chocobanana ba√±ada en doble capa de chocolate negro intenso.' },
            // $1.25
            { id: 2, name: 'Val√∫ Ivory', price: 1.00, img: 'https://i.postimg.cc/Hkrt41Sw/1000670553-removebg-preview.webp', desc: 'Nuestra cl√°sica banana cubierta de chocolate blanco cremoso, suave y delicioso, ideal para quienes aman lo dulce y delicado' },
            { id: 3, name: 'Val√∫ tango', price: 1.25, img: 'https://i.postimg.cc/vBrgL0FL/1000670549-removebg-preview-1.webp', desc: 'Banana cubierta con chocolate negro, y topping de galleta tango con crema de vainilla triturada, una combinaci√≥n irresistible' },
            { id: 4, name: 'Val√∫ Chicle Black', price: 1.25, img: 'https://i.postimg.cc/Kz2r2kmf/1000670552-removebg-preview.webp', desc: 'Banana ba√±ada en chocolate negro, decorada con palitos dulces turquesa, grageas crujientes, coronada con una bolita de chicle al final' },
            { id: 5, name: 'Val√∫ chicle intenso', price: 1.25, img: 'https://i.postimg.cc/76n1YH6k/1000670555-removebg-preview.webp', desc: 'Banana cubierta con chocolate turquesa con una bolita de chicle al final' },
            { id: 6, name: 'Val√∫ Choco Cookie', price: 1.25, img: 'https://i.postimg.cc/rygGBw3G/IMG-20250809-170227-751-2-removebg-preview.webp', desc: 'Banana ba√±ada en chocolate, cubierta con crujientes galletas oreo. Dulce, crujiente y deliciosa que te har√° caer en la tentaci√≥n.‚Äù' },
            { id: 7, name: 'Val√∫ Fresa', price: 1.25, img: 'https://i.postimg.cc/j2qHDpwJ/1000670557-removebg-preview.webp', desc: 'Nuestra Chocobanana ba√±ada en chocolate rojo, con aut√©ntico sabor a fresa. Dulzura y frescura en perfecta armon√≠a.' },
            { id: 8, name: 'Val√∫ Crunch', price: 1.25, img: 'https://i.postimg.cc/VL69mcPx/IMG-20250809-165122-573-2-removebg-preview.webp', desc: 'banana ba√±ada en chocolate negro y cubierta con man√≠ triturado ligeramente salado.' },
            { id: 9, name: 'Val√∫ Color Pop', price: 1.25, img: 'https://i.postimg.cc/VLVqNHYd/IMG-20250809-171929-053-2-removebg-preview.webp', desc: 'Banana ba√±ada en chocolate negro y cubierta con crujientes grageas anisadas de colores. Dulce, divertida y llena de sabor.' },
            { id: 10, name: 'Val√∫ Tropi coco', price: 1.25, img: 'https://i.postimg.cc/CMJc3QV7/1000670548-removebg-preview.webp', desc: 'Banana cubierta con chocolate negro y un ba√±o extremo de coco seco rallado' },
            { id: 11, name: 'Val√∫ pops', price: 1.25, img: 'https://i.postimg.cc/gjr3F4vt/1000670559-removebg-preview.webp', desc: 'Es la mezcla perfecta del chocolate blanco con caramelos en polvo que explotan tu boca' },
            // $1.50
            { id: 12, name: 'Valu Iris', price: 1.50, img: 'https://i.postimg.cc/nrdvB3BS/1000670562-removebg-preview.webp', desc: 'Banana ba√±ada en chocolate negro con crujientes Rocklets triturados, una explosi√≥n de color y sabor que te encantar√°' },
            { id: 13, name: 'Val√∫ Mixta', price: 1.50, img: 'https://i.postimg.cc/wBJcZcY3/1000670551-removebg-preview.webp', desc: 'Banana ba√±ada en chocolate verde, con crujientes trozos de Oreo y un toque fresco de menta. ¬°Refrescante, dulce y divertida, que te dejar√° congelado' },
            { id: 14, name: 'Val√∫ black&white', price: 1.50, img: 'https://i.postimg.cc/BnRBm7yd/1000670554-removebg-preview.webp', desc: 'Banana cubierta con chocolate blanco y trozos crocantes de galleta oreo' },
            // $2.50
            { id: 15, name: 'Val√∫ Espresso', price: 2.50, img: 'https://i.postimg.cc/9Qq5FhmC/1000670556-removebg-preview-1.webp', desc: 'Banana ba√±ada en chocolate, rellena con exquisito c√≥ctel de caf√© y acompa√±ada de crujientes nibs de caf√©. Dulce, cremoso y sofisticado, ideal para los amantes del caf√© y el chocolate' },
            { id: 16, name: 'Val√∫ Dulce Tentaci√≥n', price: 2.50, img: 'https://i.postimg.cc/tgtcYRLQ/1000670558-removebg-preview.webp', desc: 'banana ba√±ada en chocolate y rellena con cremoso manjar y trozos de almendra. Dulce, crujiente y sofisticada, una experiencia irresistible para los paladares m√°s exigentes.' },
        ];

        // DOM Elements
        const productList = document.getElementById('product-list');
        const cartButton = document.getElementById('cart-button');
        const cartCountEl = document.getElementById('cart-count');
        const notificationModal = document.getElementById('notification-modal');
        const notificationMessage = document.getElementById('notification-message');
        const closeNotificationBtn = document.getElementById('close-notification-btn');
        const orderForm = document.getElementById('order-form');
        const checkoutSummary = document.getElementById('checkout-summary');
        const clearCartBtn = document.getElementById('clear-cart-btn');
        const cartEmptyMessage = document.getElementById('cart-empty-message');
        const cartContent = document.getElementById('cart-content');
        const shareLocationBtn = document.getElementById('share-location-btn-checkout');
        const locationStatus = document.getElementById('location-status-checkout');

        // App State
        let cart = {};
        let sharedLocation = null;

        // --- RENDER FUNCTIONS ---
        function renderProducts() {
            productList.innerHTML = '';
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl text-center overflow-hidden flex flex-col shadow-lg transition-all duration-300 ease-in-out hover:shadow-2xl hover:scale-105 hover:-translate-y-2';
                card.innerHTML = `
                    <div class="bg-gray-50"><img src="${product.img}" alt="${product.name}" class="w-full h-56 object-contain" onerror="this.onerror=null;this.src='https://placehold.co/400x224/ffffff/3D2B1F?text=${product.name}';"></div>
                    <div class="p-6 flex-grow flex flex-col">
                        <h3 class="text-xl font-bold mb-2 brand-brown-text">${product.name}</h3>
                        <p class="text-sm flex-grow text-gray-600">${product.desc}</p>
                        <p class="font-bold brand-orange-text mt-2 text-lg">$${product.price.toFixed(2)}</p>
                        <div class="flex items-center justify-center space-x-4 my-4">
                            <button class="quantity-btn minus-btn bg-gray-200 rounded-full w-8 h-8 text-lg font-bold text-gray-700">-</button>
                            <span class="quantity-value text-lg font-bold">1</span>
                            <button class="quantity-btn plus-btn bg-gray-200 rounded-full w-8 h-8 text-lg font-bold text-gray-700">+</button>
                        </div>
                        <button class="add-to-cart-btn bg-brand-green text-white font-bold py-2 px-4 rounded-full hover:bg-brand-green-dark transition-colors" data-id="${product.id}">
                            A√±adir al Carrito
                        </button>
                    </div>
                `;
                productList.appendChild(card);
            });
        }

        // --- CART LOGIC ---
        function addToCart(productId, quantity = 1) {
            if (cart[productId]) {
                cart[productId].quantity += quantity;
            } else {
                const product = products.find(p => p.id == productId);
                cart[productId] = { ...product, quantity: quantity };
            }
            updateCartUI();
        }

        function updateCartUI() {
            let totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
            cartCountEl.textContent = totalItems;
            updateCheckoutPage();
        }
        
        function updateCheckoutPage() {
            if (document.getElementById('checkout-page').classList.contains('hidden')) return;

            let subtotal = 0;
            let summaryHTML = '';

            if (Object.keys(cart).length === 0) {
                cartEmptyMessage.classList.remove('hidden');
                cartContent.classList.add('hidden');
                return;
            }
            
            cartEmptyMessage.classList.add('hidden');
            cartContent.classList.remove('hidden');

            for (const id in cart) {
                const item = cart[id];
                subtotal += item.price * item.quantity;
                summaryHTML += `
                    <div class="py-2 border-b last:border-b-0 flex justify-between items-center">
                        <div>
                            <p class="font-bold">${item.quantity} x ${item.name}</p>
                        </div>
                        <span class="font-semibold">$${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            }

            summaryHTML += `
                <div class="mt-4 border-t pt-4 space-y-2">
                    <div class="flex justify-between"><span>Subtotal</span><span>$${subtotal.toFixed(2)}</span></div>
                    <div class="flex justify-between font-bold text-lg"><span>Total</span><span>$${subtotal.toFixed(2)}</span></div>
                </div>
            `;
            checkoutSummary.innerHTML = summaryHTML;
        }

        // --- EVENT LISTENERS ---
        productList.addEventListener('click', (e) => {
            const card = e.target.closest('.flex-col');
            if (!card) return;

            if (e.target.classList.contains('quantity-btn')) {
                const valueSpan = card.querySelector('.quantity-value');
                let currentValue = parseInt(valueSpan.textContent);
                if (e.target.classList.contains('plus-btn')) currentValue++;
                else if (e.target.classList.contains('minus-btn') && currentValue > 1) currentValue--;
                valueSpan.textContent = currentValue;
            }

            if (e.target.classList.contains('add-to-cart-btn')) {
                const id = e.target.dataset.id;
                const quantity = parseInt(card.querySelector('.quantity-value').textContent);
                addToCart(id, quantity);
                showNotification(`${quantity} ${products.find(p=>p.id==id).name}(s) a√±adido(s) al carrito!`);
                card.querySelector('.quantity-value').textContent = '1';
            }
        });
        
        clearCartBtn.addEventListener('click', () => {
            cart = {};
            updateCartUI();
        });

        orderForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();

            if (!name || !phone || !address) {
                alert('Por favor, completa todos los campos obligatorios.');
                return;
            }

            let message = `¬°Hola VAL√ö Chocobananas! üëã Quisiera hacer el siguiente pedido:\n\n`;
            let total = 0;

            for (const id in cart) {
                const item = cart[id];
                message += `*${item.quantity}x* - ${item.name}\n`;
                total += item.price * item.quantity;
            }

            message += `\n*Total del Pedido: $${total.toFixed(2)}*\n\n`;
            message += `*Mis Datos de Entrega:*\n`;
            message += `*Nombre:* ${name}\n`;
            message += `*WhatsApp:* ${phone}\n`;
            message += `*Direcci√≥n:* ${address}\n`;

            if (sharedLocation) {
                message += `*Ubicaci√≥n (Google Maps):* ${sharedLocation}\n`;
            }
            
            message += `\n*IMPORTANTE: Para confirmar tu pedido, por favor adjunta tu comprobante de pago aqu√≠ en el chat.*`;
            message += `\n\n¬°Espero su confirmaci√≥n! Gracias. üòä`;
            
            const whatsappNumber = '593983397264';
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

            window.open(whatsappUrl, '_blank');
            
            cart = {};
            sharedLocation = null;
            orderForm.reset();
            updateCartUI();
            showPage('home');
            alert('¬°Gracias por tu compra! Tu pedido se est√° procesando.');
        });
        
        shareLocationBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                locationStatus.textContent = 'Obteniendo ubicaci√≥n...';
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    sharedLocation = `https://www.google.com/maps?q=${latitude},${longitude}`;
                    locationStatus.textContent = '¬°Ubicaci√≥n compartida!';
                }, () => {
                    locationStatus.textContent = 'No se pudo obtener la ubicaci√≥n.';
                });
            } else {
                locationStatus.textContent = 'Geolocalizaci√≥n no es soportada.';
            }
        });
        
        // --- PAGE NAVIGATION ---
        const pages = document.querySelectorAll('main');
        window.showPage = (pageId) => {
            pages.forEach(page => page.classList.add('hidden'));
            document.getElementById(`${pageId}-page`).classList.remove('hidden');
            window.scrollTo(0, 0);
            if (pageId === 'checkout') updateCheckoutPage();
        };

        // --- NOTIFICATION MODAL ---
        function showNotification(message) {
            notificationMessage.textContent = message;
            notificationModal.classList.remove('opacity-0', 'pointer-events-none');
            notificationModal.querySelector('div').classList.remove('scale-95');
        }

        function hideNotification() {
            notificationModal.classList.add('opacity-0', 'pointer-events-none');
            notificationModal.querySelector('div').classList.add('scale-95');
        }

        closeNotificationBtn.addEventListener('click', hideNotification);

        // --- INITIAL LOAD ---
        renderProducts();
        updateCartUI();
    });
    </script>
</body>
</html>
