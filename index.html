<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VALÚ Chocobananas - Menú Interactivo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            /* Vibrant gradient background */
            background: linear-gradient(135deg, #FFFDE7 0%, #FFF3E0 100%);
            overflow-x: hidden; /* Prevent horizontal scroll from animations */
        }

        /* Animated Floating Background Container */
        .floating-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        /* Individual floating shapes */
        .floating-bg span {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(245, 124, 0, 0.6); /* Brand Orange */
            animation: float-up 25s linear infinite;
            bottom: -150px;
            border-radius: 50%;
        }

        /* Variations for floating shapes */
        .floating-bg span:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; background-color: rgba(46, 125, 50, 0.5); }
        .floating-bg span:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .floating-bg span:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .floating-bg span:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; background-color: rgba(255, 234, 0, 0.6); }
        .floating-bg span:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .floating-bg span:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; background-color: rgba(61, 43, 31, 0.4); }
        .floating-bg span:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .floating-bg span:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .floating-bg span:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; background-color: rgba(46, 125, 50, 0.6); }
        .floating-bg span:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        /* Keyframe animation for floating effect */
        @keyframes float-up {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                border-radius: 50%;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
                border-radius: 50%;
            }
        }

        /* Floating card style for sections */
        .floating-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .floating-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 16px 40px 0 rgba(0, 0, 0, 0.15);
        }
        
        /* Floating text effect */
        .floating-text {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Floating WhatsApp Button */
        .floating-whatsapp-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background-color: #25D366;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            animation: pulse 2s infinite;
            transition: transform 0.3s ease;
        }
        .floating-whatsapp-btn:hover {
            transform: scale(1.1);
            animation: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
        }
        
        /* Brand Colors */
        .brand-green-text { color: #1B5E20; }
        .brand-orange-text { color: #E65100; }
        .brand-brown-text { color: #3D2B1F; }
        .bg-brand-green { background-color: #2E7D32; }
        .bg-brand-orange { background-color: #F57C00; }
        .bg-brand-brown { background-color: #3D2B1F; }
        .hover\:bg-brand-green-dark:hover { background-color: #1B5E20; }
        .hover\:bg-brand-orange-dark:hover { background-color: #E65100; }
        
        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 400px; text-align: center; transform: scale(0.95); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }

    </style>
</head>
<body class="text-gray-800">

    <!-- This div creates the animated background with floating shapes -->
    <div class="floating-bg">
        <span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span>
    </div>

    <!-- Header section with the logo and brand name -->
    <header class="bg-white/80 backdrop-blur-sm shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-2 flex justify-center items-center">
            <div class="flex items-center gap-3">
                <img src="https://scontent.fptz1-1.fna.fbcdn.net/v/t1.6435-9/120623817_2756311547940742_4877580013596553030_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_ohc=mEQdu5xSycAQ7kNvwE9MaZS&_nc_oc=AdnW_LwBOBKzbCLPJnbHYRBLDwy5nb364G1MWPuam_DZujGlsV5ZDpXZmdvwVCTsOXE&_nc_zt=23&_nc_ht=scontent.fptz1-1.fna&_nc_gid=M5h8cPgjuu5YT6FtW6pIEA&oh=00_AfS4lCBjAcVVSa0Z9FIvD4nhb3rxEoMRffX247tuX_KEtw&oe=68B1EA8A" alt="Logo de VALÚ Chocobananas" class="h-24 md:h-48" onerror="this.onerror=null;this.src='https://placehold.co/200x200/FFF3E0/3D2B1F?text=VALÚ';">
                <div class="text-2xl md:text-3xl font-bold brand-green-text">
                    VALÚ <span class="brand-orange-text">Chocobananas</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Sub-header bar with slogan and social media links -->
    <section class="bg-brand-brown py-3 shadow-lg">
        <div class="container mx-auto px-6 flex flex-col sm:flex-row justify-between items-center text-yellow-50 text-center sm:text-left">
            <p class="text-sm font-semibold mb-2 sm:mb-0">El Sabor que te Encanta, la Calidad que nos Define.</p>
            <div class="flex items-center gap-4">
                <a href="https://www.facebook.com/valuchocobananas" target="_blank" class="text-yellow-50 hover:text-white transition-colors"><i class="fab fa-facebook-f fa-lg"></i></a>
                <a href="https://www.instagram.com/valuchocobananasoficial" target="_blank" class="text-yellow-50 hover:text-white transition-colors"><i class="fab fa-instagram fa-lg"></i></a>
            </div>
        </div>
    </section>

    <!-- Hero section with main headline -->
    <section class="py-20 md:py-24">
        <div class="container mx-auto px-6 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold leading-tight mb-4 floating-text brand-brown-text">Más que un postre, una experiencia.</h1>
            <p class="text-lg md:text-xl max-w-3xl mx-auto brand-brown-text">Te esperamos en nuestro ambiente confortable que huele riquísimo. Descubre una amplia carta de chocobananas que no sabrás cuál elegir.</p>
        </div>
    </section>

    <!-- Features section with three key points -->
    <section class="pb-16">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-3 gap-8">
                <div class="floating-card p-8 text-center">
                    <div class="bg-brand-green text-white rounded-full p-5 mb-4 inline-block"><i class="fas fa-couch fa-2x"></i></div>
                    <h3 class="text-xl font-bold mb-2 brand-brown-text">Ambiente Acogedor</h3>
                    <p>Disfruta en nuestro rincón amplio, confortable y perfecto para compartir.</p>
                </div>
                <div class="floating-card p-8 text-center">
                    <div class="bg-brand-orange text-white rounded-full p-5 mb-4 inline-block"><i class="fas fa-book-open fa-2x"></i></div>
                    <h3 class="text-xl font-bold mb-2 brand-brown-text">Variedad Increíble</h3>
                    <p>Una amplia y variada carta de chocobananas con opciones para todos los gustos.</p>
                </div>
                <div class="floating-card p-8 text-center">
                    <div class="bg-brand-green text-white rounded-full p-5 mb-4 inline-block"><i class="fas fa-star fa-2x"></i></div>
                    <h3 class="text-xl font-bold mb-2 brand-brown-text">Experiencia Sensorial</h3>
                    <p>Un lugar que no solo se ve bien, sino que además ¡huele riquísimo!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Us section -->
    <section class="pb-16">
        <div class="container mx-auto px-6">
            <div class="floating-card p-8 md:p-12 md:flex items-center gap-12">
                <div class="md:w-1/2 mb-8 md:mb-0">
                    <img src="https://scontent.fptz1-1.fna.fbcdn.net/v/t39.30808-6/522644453_1330666818690196_6211870659271154166_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=127cfc&_nc_ohc=J7PColix9oUQ7kNvwHrJgCt&_nc_oc=AdkEIKzeC8PV5t-i31Jn-FmnYoOUrYWyxmqJXlH7TLl6_wFW9_9946FIEq3I6xAan-8&_nc_zt=23&_nc_ht=scontent.fptz1-1.fna&_nc_gid=P5lVp-3c9cnxn8HF1EI20A&oh=00_AfSP3oiZpjd3WEbksEAAtuWK4UaksGis-FjG-31rW7r3wg&oe=68903D1A" alt="Frente del local de VALÚ Chocobananas" class="rounded-lg shadow-xl w-full h-auto" onerror="this.onerror=null;this.src='https://placehold.co/600x400/FFF3E0/3D2B1F?text=Local';">
                </div>
                <div class="md:w-1/2">
                    <h2 class="text-3xl font-bold mb-4 brand-green-text floating-text">¡Hola, somos <span class="brand-orange-text">VALÚ Chocobananas!</span></h2>
                    <p class="mb-4">Tu rincón favorito en el corazón de Shushufindi. Nacimos para convertir un postre clásico en una experiencia inolvidable. Nos enorgullece ofrecerte la más amplia y deliciosa carta de chocobananas que puedas imaginar, ¡te aseguramos que no sabrás cuál elegir!.</p>
                    <p>Más que solo un producto, queremos que te sientas como en casa. Por eso, hemos creado un espacio amplio, confortable y con un ambiente súper acogedor. Te esperamos de lunes a sábado para que compartas un momento dulce y divertido. ¡Somos el punto de encuentro perfecto para todos los "Valú Lovers"!</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Menu section with product cards -->
    <section class="pb-16">
        <div class="container mx-auto px-6">
            <h2 id="menu-title" class="text-3xl font-bold mb-12 text-center brand-brown-text floating-text">Nuestros Sabores</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Each card is a menu item, clickable for ordering -->
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Crujiente de Maní" data-price="1.00"><img src="https://i.postimg.cc/wBJcZcY3/1000670551-removebg-preview.webp" alt="Chocobanana con maní" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Crujiente+de+Maní';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Crujiente de Maní</h3><p class="text-sm">La combinación perfecta de chocolate cremoso y maní tostado. ¡Un clásico irresistible! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Fiesta de Chispas" data-price="1.00"><img src="https://i.postimg.cc/Kz2r2kmf/1000670552-removebg-preview.webp" alt="Chocobanana con chispas de colores" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Fiesta+de+Chispas';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Fiesta de Chispas</h3><p class="text-sm">Bañada en chocolate y cubierta con una explosión de grageas de colores. ¡Pura diversión! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Sueño Blanco" data-price="1.00"><img src="https://i.postimg.cc/Hkrt41Sw/1000670553-removebg-preview.webp" alt="Chocobanana con cobertura de chocolate blanco y chispas" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Sueño+Blanco';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Sueño Blanco</h3><p class="text-sm">Delicado chocolate blanco con chispas de chocolate oscuro. ¡Un contraste delicioso! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Galleta Manía" data-price="1.00"><img src="https://i.postimg.cc/vBrgL0FL/1000670549-removebg-preview-1.webp" alt="Chocobanana con galleta" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Galleta+Manía';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Galleta Manía</h3><p class="text-sm">Tu galleta favorita triturada sobre una capa de chocolate. ¡La mejor combinación! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Choco-Chispas" data-price="1.00"><img src="https://i.postimg.cc/BnRBm7yd/1000670554-removebg-preview.webp" alt="Chocobanana con chispas de chocolate" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Choco-Chispas';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Choco-Chispas</h3><p class="text-sm">Para los verdaderos amantes del chocolate. ¡Doble dosis de sabor y textura! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Nieve de Coco" data-price="1.00"><img src="https://i.postimg.cc/76n1YH6k/1000670555-removebg-preview.webp" alt="Chocobanana con coco rallado" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Nieve+de+Coco';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Nieve de Coco</h3><p class="text-sm">Un viaje tropical con cada mordida. Bañada en chocolate y cubierta de coco fresco. <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Corazón de Amor" data-price="1.00"><img src="https://i.postimg.cc/j2qHDpwJ/1000670557-removebg-preview.webp" alt="Chocobanana con decorado de corazón" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Corazón+de+Amor';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Corazón de Amor</h3><p class="text-sm">El clásico de chocolate con un toque especial de amor. ¡Ideal para compartir! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Doble Chocolate" data-price="1.00"><img src="https://i.postimg.cc/VL69mcPx/IMG-20250809-165122-573-2-removebg-preview.webp" alt="Chocobanana con decorado de chocolate blanco" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Doble+Chocolate';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Doble Chocolate</h3><p class="text-sm">Base de chocolate oscuro con un elegante decorado de chocolate blanco. <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Explosión Crujiente" data-price="1.00"><img src="https://i.postimg.cc/nrdvB3BS/1000670562-removebg-preview.webp" alt="Chocobanana con arroz inflado" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Explosión+Crujiente';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Explosión Crujiente</h3><p class="text-sm">Una capa de chocolate cubierta con arroz inflado achocolatado. ¡Súper crujiente! <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Fresa Pasión" data-price="1.00"><img src="https://i.postimg.cc/rygGBw3G/IMG-20250809-170227-751-2-removebg-preview.webp" alt="Chocobanana con topping de fresa" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Fresa+Pasión';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Fresa Pasión</h3><p class="text-sm">Una dulce cobertura de chocolate con un toque de fresa y decoraciones románticas. <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
                <div class="floating-card text-center overflow-hidden cursor-pointer" data-flavor="Almendra Tostada" data-price="1.00"><img src="https://i.postimg.cc/VLVqNHYd/IMG-20250809-171929-053-2-removebg-preview.webp" alt="Chocobanana con almendras" class="w-full h-56 object-contain bg-white/20 pointer-events-none" onerror="this.onerror=null;this.src='https://placehold.co/400x224/FFF3E0/3D2B1F?text=Almendra+Tostada';"><div class="p-6 pointer-events-none"><h3 class="text-xl font-bold mb-2 brand-brown-text">Almendra Tostada</h3><p class="text-sm">Chocolate premium cubierto con trocitos de almendra tostada para un sabor sofisticado. <br><span class="font-bold brand-orange-text mt-2 block">Costo: $1.00</span></p></div></div>
            </div>
        </div>
    </section>

    <!-- Footer with contact information -->
    <footer id="footer-contact" class="bg-brand-brown text-yellow-50 pt-12 pb-8 mt-16">
        <div class="container mx-auto px-6 text-center">
            <div class="grid md:grid-cols-3 gap-8">
                <div class="mb-6 md:mb-0">
                    <h4 class="font-bold text-lg mb-2 text-white">Contacto</h4>
                    <p><i class="fab fa-whatsapp mr-2"></i> +593 98 919 6228</p>
                    <p><i class="fas fa-envelope mr-2"></i> valuchocobananas@gmail.com</p>
                </div>
                <div class="mb-6 md:mb-0">
                    <h4 class="font-bold text-lg mb-2 text-white">Ubicación</h4>
                    <a href="https://maps.app.goo.gl/ZjvLQER2vHgL6kSQ6" target="_blank" class="inline-block hover:text-white transition-colors"><i class="fas fa-map-marker-alt mr-2"></i> Siona y 7 de agosto</a>
                    <p>Shushufindi, Ecuador</p>
                </div>
                <div class="mb-6 md:mb-0">
                    <h4 class="font-bold text-lg mb-2 text-white">Horario</h4>
                    <p>Lunes a Sábado</p>
                    <p>3:00 PM - 7:30 PM</p>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-white/20 flex flex-col sm:flex-row justify-between items-center">
                <p class="text-sm text-white/70 mb-4 sm:mb-0">&copy; 2024 VALÚ Chocobananas. Todos los derechos reservados.</p>
                <div>
                    <a href="https://www.facebook.com/valuchocobananas" target="_blank" class="text-white/70 hover:text-white mx-2 text-xl"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/valuchocobananasoficial" target="_blank" class="text-white/70 hover:text-white mx-2 text-xl"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Floating WhatsApp button -->
    <a href="https://wa.me/593989196228?text=¡Hola%20VALÚ%20Chocobananas!%20Quisiera%20hacer%20un%20pedido%20o%20tengo%20una%20consulta." target="_blank" class="floating-whatsapp-btn">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Modal for collecting customer's name and quantity -->
    <div id="name-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 brand-brown-text">¡Casi listo!</h2>
            <p class="mb-4">Para identificar tu pedido, por favor ingresa tu nombre y la cantidad que deseas.</p>
            <div class="mb-4">
                <label for="customer-name" class="block text-left font-semibold mb-1">Tu Nombre:</label>
                <input type="text" id="customer-name" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:border-brand-orange focus:ring-brand-orange" placeholder="Ej: Carlos">
            </div>
            <div class="mb-6">
                <label for="order-quantity" class="block text-left font-semibold mb-1">Cantidad:</label>
                <input type="number" id="order-quantity" value="1" min="1" max="20" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:border-brand-orange focus:ring-brand-orange">
            </div>
            <button id="submit-order" class="bg-brand-orange text-white font-bold py-2 px-6 rounded-full w-full hover:bg-brand-orange-dark transition-colors">Confirmar Pedido</button>
            <button id="cancel-order" class="text-gray-500 mt-2">Cancelar</button>
        </div>
    </div>
    
    <!-- Modal for order confirmation -->
    <div id="confirmation-modal" class="modal-overlay">
         <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 brand-green-text">¡Pedido Enviado!</h2>
            <p id="confirmation-message" class="mb-4">Tu chocobanana llegará a tu mesa en un momento.</p>
            <button id="close-confirmation" class="bg-brand-green text-white font-bold py-2 px-6 rounded-full w-full hover:bg-brand-green-dark transition-colors">¡Genial!</button>
        </div>
    </div>
    
    <!-- Generic Alert Modal to replace native alert() -->
    <div id="alert-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="alert-modal-title" class="text-2xl font-bold mb-4 brand-orange-text"></h2>
            <p id="alert-modal-message" class="mb-6"></p>
            <button id="close-alert-modal" class="bg-brand-orange text-white font-bold py-2 px-6 rounded-full w-full hover:bg-brand-orange-dark transition-colors">Entendido</button>
        </div>
    </div>


    <script type="module">
        // Import Firebase services
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', () => {
            // Securely initialize Firebase using environment variables
            if (typeof __firebase_config === 'undefined' || typeof __app_id === 'undefined') {
                console.error("Error: Firebase configuration or App ID is missing.");
                // Disable ordering functionality if Firebase isn't configured
                document.querySelectorAll('[data-flavor]').forEach(card => card.style.cursor = 'not-allowed');
                showAlertModal('Error de Configuración', 'El sistema de pedidos no está disponible en este momento. Por favor, avisa al personal.');
                return;
            }
            
            const firebaseConfig = JSON.parse(__firebase_config);
            const appId = __app_id;

            // Initialize Firebase App
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);

            let dbReady = false;
            let tableNumber = null;
            let selectedFlavor = null;
            let selectedPrice = null;

            // Handle authentication state changes
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("User authenticated:", user.uid);
                    dbReady = true;
                } else {
                    console.log("User is not authenticated. Attempting to sign in.");
                    signIn(); // Attempt to sign in if the user is not authenticated
                }
            });

            // Sign in the user, preferring a custom token if available
            async function signIn() {
                if (auth.currentUser) return;
                try {
                    if (typeof __initial_auth_token !== 'undefined') {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Authentication Error:", error);
                    showAlertModal('Error de Autenticación', 'No se pudo verificar la sesión. Por favor, recarga la página.');
                }
            }
            
            // Get table number from URL parameters
            function getTableNumber() {
                const params = new URLSearchParams(window.location.search);
                return params.get('table');
            }

            // Send order data to Firestore and Webhook
            async function sendOrder(flavor, price, customerName, quantity) {
                if (!dbReady || !tableNumber || !appId) {
                    showAlertModal('Error de Conexión', 'No se pudo conectar con el sistema. Por favor, refresca la página o contacta al personal.');
                    return;
                }

                // 1. Prepare the order data for both Firestore and the webhook
                const orderData = {
                    table: `${tableNumber}`,
                    flavor: flavor,
                    price: price,
                    customer: customerName,
                    quantity: quantity,
                    status: "pending",
                    timestamp: new Date().toISOString() // Use a consistent ISO string timestamp
                };

                // 2. Send data to Firestore
                try {
                    const ordersCollection = collection(db, `artifacts/${appId}/public/data/orders`);
                    // Firestore will use its own server-side timestamp for accuracy
                    await addDoc(ordersCollection, { ...orderData, timestamp: serverTimestamp() });
                    console.log("Order successfully saved to Firestore.");
                } catch (error) {
                    console.error("Error sending order to Firestore: ", error);
                    showAlertModal('Error de Pedido', 'Hubo un problema al guardar tu pedido. Por favor, inténtalo de nuevo.');
                    return; // Stop if saving to the database fails
                }

                // 3. Send data to the dispatch webhook
                try {
                    const webhookUrl = 'https://crissbot-n8n.raf5ac.easypanel.host/webhook/91f9adeb-b0a2-4f40-a7b4-38c0508d9ecf';
                    await fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(orderData),
                    });
                    console.log("Order notification successfully sent to webhook.");
                } catch (error) {
                    console.error("Error sending webhook notification: ", error);
                    // Do not show an error to the user here, as the order was placed successfully.
                    // This is a background notification failure.
                }
                
                // 4. Show confirmation to the user
                const plural = quantity > 1 ? 's' : '';
                showConfirmationModal(`¡Gracias, ${customerName}! Tu pedido de <strong>${quantity} chocobanana${plural} de ${flavor}</strong> va en camino a la <strong>Mesa ${tableNumber}</strong>.`);
            }

            // Get references to all modal elements
            const nameModal = document.getElementById('name-modal');
            const confirmationModal = document.getElementById('confirmation-modal');
            const alertModal = document.getElementById('alert-modal');
            const customerNameInput = document.getElementById('customer-name');
            const quantityInput = document.getElementById('order-quantity');
            
            // Functions to show/hide modals
            function showNameModal(flavor, price) {
                selectedFlavor = flavor;
                selectedPrice = price;
                quantityInput.value = 1; // Reset quantity to 1 each time
                nameModal.classList.add('visible');
                customerNameInput.focus();
            }

            function hideNameModal() {
                nameModal.classList.remove('visible');
                customerNameInput.value = '';
            }

            function showConfirmationModal(message) {
                document.getElementById('confirmation-message').innerHTML = message;
                confirmationModal.classList.add('visible');
            }
            
            function showAlertModal(title, message) {
                document.getElementById('alert-modal-title').textContent = title;
                document.getElementById('alert-modal-message').textContent = message;
                alertModal.classList.add('visible');
            }

            function hideAlertModal() {
                alertModal.classList.remove('visible');
            }

            // Initial page setup logic
            signIn();
            tableNumber = getTableNumber();
            const menuTitle = document.getElementById('menu-title');

            if (tableNumber) {
                menuTitle.innerHTML = `MENÚ MESA <span class="brand-orange-text">#${tableNumber}</span> - ¡Elige tu Sabor!`;
            }

            // Add click listeners to all product cards
            document.querySelectorAll('[data-flavor]').forEach(card => {
                card.addEventListener('click', () => {
                    if (!tableNumber) {
                        showAlertModal('¡Escanea el QR!', 'Para poder ordenar, por favor escanea el código QR que se encuentra en tu mesa.');
                        return;
                    }
                    const flavor = card.getAttribute('data-flavor');
                    const price = parseFloat(card.getAttribute('data-price'));
                    showNameModal(flavor, price);
                });
            });

            // Add click listeners for all modal buttons
            document.getElementById('submit-order').addEventListener('click', () => {
                const customerName = customerNameInput.value.trim();
                const quantity = parseInt(quantityInput.value, 10);

                if (!customerName) {
                    showAlertModal('¡Un momento!', 'Por favor, ingresa tu nombre para poder continuar.');
                    return;
                }
                if (isNaN(quantity) || quantity < 1) {
                    showAlertModal('Cantidad Inválida', 'Por favor, ingresa una cantidad válida.');
                    return;
                }

                if (selectedFlavor && selectedPrice != null) {
                    sendOrder(selectedFlavor, selectedPrice, customerName, quantity);
                    hideNameModal();
                }
            });

            document.getElementById('cancel-order').addEventListener('click', hideNameModal);
            document.getElementById('close-confirmation').addEventListener('click', () => confirmationModal.classList.remove('visible'));
            document.getElementById('close-alert-modal').addEventListener('click', hideAlertModal);
        });
    </script>
</body>
</html>
